import { Hono } from 'hono';
import { cors } from 'hono/cors';
import { GoogleGenerativeAI } from '@google/generative-ai';

// ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚ (Ñ€Ð°Ð½ÐµÐµ Ð² constants.ts)
const PRODUCT_TYPES = ['ÐšÐ¾Ñ€Ð¾Ð±ÐºÐ°', 'ÐŸÐ°ÐºÐµÑ‚ Ð±ÑƒÐ¼Ð°Ð¶Ð½Ñ‹Ð¹', 'Ð¢Ð¸ÑˆÑŒÑŽ Ð±ÑƒÐ¼Ð°Ð³Ð°'];
const BOX_TYPES = ['Ð¡Ð°Ð¼Ð¾ÑÐ±Ð¾Ñ€Ð½Ð°Ñ', 'ÐšÑ€Ñ‹ÑˆÐºÐ°-Ð´Ð½Ð¾', 'ÐŸÐµÐ½Ð°Ð»'];
const MATERIALS = ['ÐœÐµÐ»Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ð±ÑƒÐ¼Ð°Ð³Ð°', 'Ð“Ð¾Ñ„Ñ€Ð¾ÐºÐ°Ñ€Ñ‚Ð¾Ð½ Ð¢23 Ð‘Ð•Ð›Ð«Ð™', 'Ð‘ÑƒÐ¼Ð°Ð³Ð° Futbort', 'Ð¢Ð¸ÑˆÑŒÑŽ', 'ÐšÐ°Ñ€Ñ‚Ð¾Ð½', 'Ð¡Ð¿ÐµÑ†Ð¸Ð°Ð»ÑŒÐ½Ð°Ñ/Ð´Ð¸Ð·Ð°Ð¹Ð½ÐµÑ€ÑÐºÐ°Ñ Ð±ÑƒÐ¼Ð°Ð³Ð°', 'ÐšÑ€Ð°Ñ„Ñ‚-Ð±ÑƒÐ¼Ð°Ð³Ð°'];
const PRINT_TYPES = ['ÐžÑ„ÑÐµÑ‚Ð½Ð°Ñ Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ', 'Ð¤Ð»ÐµÐºÑÐ¾Ð³Ñ€Ð°Ñ„Ð¸Ñ', 'Ð¦Ð¸Ñ„Ñ€Ð¾Ð²Ð°Ñ Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ', 'Ð¨ÐµÐ»ÐºÐ¾Ð³Ñ€Ð°Ñ„Ð¸Ñ'];
const FINISH_TYPES = ['ÐœÐ°Ñ‚Ð¾Ð²Ð°Ñ Ð»Ð°Ð¼Ð¸Ð½Ð°Ñ†Ð¸Ñ', 'Ð“Ð»ÑÐ½Ñ†ÐµÐ²Ð°Ñ Ð»Ð°Ð¼Ð¸Ð½Ð°Ñ†Ð¸Ñ', 'Soft-touch Ð»Ð°Ð¼Ð¸Ð½Ð°Ñ†Ð¸Ñ', 'Ð£Ð¤-Ð»Ð°Ðº (Ð²Ñ‹Ð±Ð¾Ñ€Ð¾Ñ‡Ð½Ñ‹Ð¹/ÑÐ¿Ð»Ð¾ÑˆÐ½Ð¾Ð¹)', 'Ð¢Ð¸ÑÐ½ÐµÐ½Ð¸Ðµ (Ñ„Ð¾Ð»ÑŒÐ³Ð¾Ð¹/ÐºÐ¾Ð½Ð³Ñ€ÐµÐ²)', 'Ð’Ñ‹Ñ€ÑƒÐ±ÐºÐ°'];
const HANDLE_TYPES = ['Ð›ÐµÐ½Ñ‚Ð° Ñ€ÐµÐ¿ÑÐ¾Ð²Ð°Ñ', 'Ð’ÐµÑ€ÐµÐ²Ð¾Ñ‡Ð½Ñ‹Ðµ', 'Ð‘ÑƒÐ¼Ð°Ð¶Ð½Ñ‹Ðµ', 'Ð’Ñ‹Ñ€ÑƒÐ±Ð½Ð°Ñ Ñ€ÑƒÑ‡ÐºÐ°'];
const HANDLE_ATTACHMENTS = ['Ð’ÐºÐ»ÐµÐµÐ½Ð½Ñ‹Ðµ', 'ÐÐ° Ð»ÑŽÐ²ÐµÑ€ÑÐ°Ñ…'];

// Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³Ð° CSV-ÑÑ‚Ñ€Ð¾ÐºÐ¸
function parseCSV(csvString) {
  const lines = csvString.trim().split('\n');
  const headers = lines[0].split(',').map(header => header.trim());
  const data = [];

  for (let i = 1; i < lines.length; i++) {
    const values = lines[i].split(',');
    const row = {};
    for (let j = 0; j < headers.length; j++) {
      row[headers[j]] = values[j] ? values[j].trim() : '';
    }
    data.push(row);
  }
  return data;
}

const app = new Hono();

// ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° CORS
app.use('/*', cors());

// Ð‘Ð°Ð·Ð° Ð·Ð½Ð°Ð½Ð¸Ð¹ Ð¸ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Ñ†ÐµÐ½Ð¾Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ñ (Ñ€Ð°Ð½ÐµÐµ Ð² constants.ts)
const KNOWLEDGE_BASE_STRUCTURE_PROMPT = `
Ð¢Ð²Ð¾Ñ Ð±Ð°Ð·Ð° Ð·Ð½Ð°Ð½Ð¸Ð¹ - ÑÑ‚Ð¾ Ð°Ð½Ð°Ð»Ð¾Ð³ Google Ð¢Ð°Ð±Ð»Ð¸Ñ†Ñ‹ ÑÐ¾ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¼Ð¸ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ°Ð¼Ð¸:
ID (ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€),
ProductType (Ð¢Ð¸Ð¿ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ†Ð¸Ð¸: ${PRODUCT_TYPES.join(', ')}, Ð‘Ð¸Ñ€ÐºÐ°),
SpecificType (Ð£Ñ‚Ð¾Ñ‡Ð½ÐµÐ½Ð¸Ðµ Ñ‚Ð¸Ð¿Ð°, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð´Ð»Ñ ÐºÐ¾Ñ€Ð¾Ð±Ð¾Ðº: ${BOX_TYPES.join(', ')}),
Quantity (ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾, ÑˆÑ‚.),
PricePerUnit_CNY (Ð¦ÐµÐ½Ð° Ð·Ð° ÐµÐ´Ð¸Ð½Ð¸Ñ†Ñƒ, ÑŽÐ°Ð½Ð¸),
Width_mm (Ð¨Ð¸Ñ€Ð¸Ð½Ð°, Ð¼Ð¼),
Height_mm (Ð’Ñ‹ÑÐ¾Ñ‚Ð°, Ð¼Ð¼),
Depth_mm (Ð“Ð»ÑƒÐ±Ð¸Ð½Ð°/Ð¢Ð¾Ð»Ñ‰Ð¸Ð½Ð°, Ð¼Ð¼),
Material (ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð»: ${MATERIALS.join(', ')}, Ð¸Ð»Ð¸ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, "Ð“Ð¾Ñ„Ñ€Ð¾ÐºÐ°Ñ€Ñ‚Ð¾Ð½ Ð¢23 Ð‘Ð•Ð›Ð«Ð™", "Ð±ÑƒÐ¼Ð°Ð³Ð° futbort"),
MaterialDensity_gsm (ÐŸÐ»Ð¾Ñ‚Ð½Ð¾ÑÑ‚ÑŒ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð°, Ð³/Ð¼2, ÐµÑÐ»Ð¸ Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ð¸Ð¼Ð¾),
PrintColors_Outer (Ð¦Ð²ÐµÑ‚Ð½Ð¾ÑÑ‚ÑŒ ÑÐ½Ð°Ñ€ÑƒÐ¶Ð¸, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, "4+0 CMYK", "1+0 Pantone", "Ð‘ÐµÐ· Ð¿ÐµÑ‡Ð°Ñ‚Ð¸", "Ñ‡ÐµÑ€Ð½Ñ‹Ð¹ Ð»Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿"),
PrintColors_Inner (Ð¦Ð²ÐµÑ‚Ð½Ð¾ÑÑ‚ÑŒ Ð²Ð½ÑƒÑ‚Ñ€Ð¸, Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ð¾, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ "Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð¿Ð°ÐºÐµÑ‚ Ð±ÐµÐ»Ñ‹Ð¹"),
PrintType (Ð¢Ð¸Ð¿ Ð¿ÐµÑ‡Ð°Ñ‚Ð¸: ${PRINT_TYPES.join(', ')}),
Finish1 (ÐžÑ‚Ð´ÐµÐ»ÐºÐ° 1: ${FINISH_TYPES.join(', ')}),
Finish2 (ÐžÑ‚Ð´ÐµÐ»ÐºÐ° 2, Ð¸ Ñ‚.Ð´.),
HandlesType (Ð¢Ð¸Ð¿ Ñ€ÑƒÑ‡ÐµÐº Ð´Ð»Ñ Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²: ${HANDLE_TYPES.join(', ')}, "Ð¿ÐµÑ‚Ð»ÐµÐ²Ñ‹Ðµ", "Ñ‚Ð¾Ð½ÐºÐ¸Ðµ"),
HandleAttachment (ÐšÑ€ÐµÐ¿Ð»ÐµÐ½Ð¸Ðµ Ñ€ÑƒÑ‡ÐµÐº: ${HANDLE_ATTACHMENTS.join(', ')}, "Ð¿Ñ€Ð¸ÐºÐ»ÐµÐ¸Ð²Ð°Ð½Ð¸Ðµ"),
Fittings (Ð¤ÑƒÑ€Ð½Ð¸Ñ‚ÑƒÑ€Ð°, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, "Ð›ÑŽÐ²ÐµÑ€ÑÑ‹", "ÐœÐ°Ð³Ð½Ð¸Ñ‚Ñ‹"),
Notes (ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ñ, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, "Ð¡Ð»Ð¾Ð¶Ð½Ð°Ñ Ð²Ñ‹ÑÐµÑ‡ÐºÐ°", "Ð¡Ñ€Ð¾Ñ‡Ð½Ñ‹Ð¹ Ð·Ð°ÐºÐ°Ð·", "Ñ‚ÐµÐºÑÑ‚ÑƒÑ€Ð° Ð¾ÑÐ½Ð¾Ð²Ñ‹ Ñ…Ð»Ð¾Ð¿ÐºÐ¾Ð²Ð°Ñ").

ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ (Ð³Ð¸Ð¿Ð¾Ñ‚ÐµÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ, Ð´Ð»Ñ Ð¿Ð¾Ð½Ð¸Ð¼Ð°Ð½Ð¸Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹):
- ID: 1, ProductType: ÐŸÐ°ÐºÐµÑ‚ Ð±ÑƒÐ¼Ð°Ð¶Ð½Ñ‹Ð¹, Quantity: 1000, PricePerUnit_CNY: 2.5, Width_mm: 300, Height_mm: 400, Depth_mm: 100, Material: ÐœÐµÐ»Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ð±ÑƒÐ¼Ð°Ð³Ð°, MaterialDensity_gsm: 230, PrintColors_Outer: 4+0 CMYK, PrintType: ÐžÑ„ÑÐµÑ‚Ð½Ð°Ñ Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ, Finish1: ÐœÐ°Ñ‚Ð¾Ð²Ð°Ñ Ð»Ð°Ð¼Ð¸Ð½Ð°Ñ†Ð¸Ñ, HandlesType: Ð›ÐµÐ½Ñ‚Ð° Ñ€ÐµÐ¿ÑÐ¾Ð²Ð°Ñ, HandleAttachment: Ð’ÐºÐ»ÐµÐµÐ½Ð½Ñ‹Ðµ.
- ID: 2, ProductType: ÐšÐ¾Ñ€Ð¾Ð±ÐºÐ°, SpecificType: Ð¡Ð°Ð¼Ð¾ÑÐ±Ð¾Ñ€Ð½Ð°Ñ, Quantity: 500, PricePerUnit_CNY: 5.0, Width_mm: 200, Height_mm: 150, Depth_mm: 50, Material: Ð“Ð¾Ñ„Ñ€Ð¾ÐºÐ°Ñ€Ñ‚Ð¾Ð½ Ð¢23, PrintColors_Outer: 1+0 Pantone, PrintType: Ð¤Ð»ÐµÐºÑÐ¾Ð³Ñ€Ð°Ñ„Ð¸Ñ.
- ID: 3, ProductType: Ð¢Ð¸ÑˆÑŒÑŽ Ð±ÑƒÐ¼Ð°Ð³Ð°, Quantity: 5000, PricePerUnit_CNY: 0.3, Width_mm: 500, Height_mm: 700, Depth_mm: N/A, Material: Ð¢Ð¸ÑˆÑŒÑŽ, MaterialDensity_gsm: 17, PrintColors_Outer: 1+0 Pantone.
- ID: 4, ProductType: Ð‘Ð¸Ñ€ÐºÐ°, Quantity: 6000, PricePerUnit_CNY: 0.5, Width_mm: 60, Height_mm: 100, Material: ÐšÐ°Ñ€Ñ‚Ð¾Ð½, MaterialDensity_gsm: 300, PrintColors_Outer: "Ñ‚Ð¸ÑÐ½ÐµÐ½Ð¸Ðµ Ð±ÐµÐ»Ñ‹Ð¼", Notes: "Ñ‚ÐµÐºÑÑ‚ÑƒÑ€Ð° Ñ…Ð»Ð¾Ð¿ÐºÐ¾Ð²Ð°Ñ, Ð¾Ñ‚Ð²ÐµÑ€ÑÑ‚Ð¸Ðµ 5Ð¼Ð¼".
`;

const PRICING_RULES_PROMPT = `
Ð’Ð°Ð¶Ð½Ñ‹Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Ð¸ Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸ Ñ†ÐµÐ½Ð¾Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ñ:

**ÐžÐ±Ñ‰Ð¸Ðµ Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿Ñ‹:**
1.  **ÐšÐ›Ð®Ð§Ð•Ð’ÐžÐ• ÐŸÐ ÐÐ’Ð˜Ð›Ðž: Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÑŒ Ñ†ÐµÐ½Ñ‹ Ð¾Ñ‚ Ñ‚Ð¸Ñ€Ð°Ð¶Ð°:** Ð¦ÐµÐ½Ð° Ð·Ð° ÐµÐ´Ð¸Ð½Ð¸Ñ†Ñƒ ÐžÐ‘Ð¯Ð—ÐÐ¢Ð•Ð›Ð¬ÐÐž Ð¸ Ð—ÐÐÐ§Ð˜Ð¢Ð•Ð›Ð¬ÐÐž ÑÐ½Ð¸Ð¶Ð°ÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ ÑƒÐ²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð¸Ð¸ Ñ‚Ð¸Ñ€Ð°Ð¶Ð°, Ð•Ð¡Ð›Ð˜ Ð’Ð¡Ð• ÐžÐ¡Ð¢ÐÐ›Ð¬ÐÐ«Ð• ÐŸÐÐ ÐÐœÐ•Ð¢Ð Ð« ÐÐ‘Ð¡ÐžÐ›Ð®Ð¢ÐÐž Ð˜Ð”Ð•ÐÐ¢Ð˜Ð§ÐÐ«. Ð­Ñ‚Ð¾ Ð½ÐµÐ»Ð¸Ð½ÐµÐ¹Ð½Ð°Ñ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÑŒ. Ð•ÑÐ»Ð¸ Ñ€Ð°ÑÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑˆÑŒ Ð´Ð²Ð° Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð° Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð¸Ð·Ð´ÐµÐ»Ð¸Ñ, Ð¾Ñ‚Ð»Ð¸Ñ‡Ð°ÑŽÑ‰Ð¸Ñ…ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‚Ð¸Ñ€Ð°Ð¶Ð¾Ð¼, Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Ñ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ð¼ Ñ‚Ð¸Ñ€Ð°Ð¶Ð¾Ð¼ Ð”ÐžÐ›Ð–Ð•Ð Ð¸Ð¼ÐµÑ‚ÑŒ ÐœÐ•ÐÐ¬Ð¨Ð£Ð® Ñ†ÐµÐ½Ñƒ Ð·Ð° ÐµÐ´Ð¸Ð½Ð¸Ñ†Ñƒ. ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ñ†ÐµÐ½Ð° Ð·Ð° 1000ÑˆÑ‚ Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾ Ð½Ð° 20-40% Ð½Ð¸Ð¶Ðµ Ñ†ÐµÐ½Ñ‹ Ð·Ð° 500ÑˆÑ‚ Ð´Ð»Ñ Ð¿Ð°ÐºÐµÑ‚Ð¾Ð².
2.  ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹: Ð¡Ð¿ÐµÑ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð¸ Ð´Ð¸Ð·Ð°Ð¹Ð½ÐµÑ€ÑÐºÐ¸Ðµ Ð±ÑƒÐ¼Ð°Ð³Ð¸, Ð¿Ð»Ð¾Ñ‚Ð½Ñ‹Ð¹ ÐºÐ°Ñ€Ñ‚Ð¾Ð½ (300Ð³/Ð¼2 Ð¸ Ð²Ñ‹ÑˆÐµ), ÐºÐ°ÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð¼Ð¸ÐºÑ€Ð¾Ð³Ð¾Ñ„Ñ€Ð¾ÐºÐ°Ñ€Ñ‚Ð¾Ð½, ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¼Ð°Ñ€ÐºÐ¸ Ð³Ð¾Ñ„Ñ€Ð¾ÐºÐ°Ñ€Ñ‚Ð¾Ð½Ð° Ð´Ð¾Ñ€Ð¾Ð¶Ðµ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ñ….
3.  Ð¡Ð»Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ Ð¿ÐµÑ‡Ð°Ñ‚Ð¸: Ð‘Ð¾Ð»ÑŒÑˆÐµÐµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ†Ð²ÐµÑ‚Ð¾Ð², Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ Pantone, Ð¿Ð¾Ð»Ð½Ð¾Ñ†Ð²ÐµÑ‚Ð½Ð°Ñ Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ Ð½Ð° Ð±Ð¾Ð»ÑŒÑˆÐ¸Ñ… Ð¿Ð¾Ð²ÐµÑ€Ñ…Ð½Ð¾ÑÑ‚ÑÑ… ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°ÑŽÑ‚ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ. ÐŸÐµÑ‡Ð°Ñ‚ÑŒ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð¸Ð·Ð´ÐµÐ»Ð¸Ñ Ñ‚Ð°ÐºÐ¶Ðµ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÑ‚ Ðº Ñ†ÐµÐ½Ðµ.
4.  ÐžÑ‚Ð´ÐµÐ»ÐºÐ°: ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð²Ð¸Ð´ Ð¾Ñ‚Ð´ÐµÐ»ÐºÐ¸ (Ð»Ð°Ð¼Ð¸Ð½Ð°Ñ†Ð¸Ñ, Ñ‚Ð¸ÑÐ½ÐµÐ½Ð¸Ðµ, Ð£Ð¤-Ð»Ð°Ðº, ÐºÐ¾Ð½Ð³Ñ€ÐµÐ²) Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÑ‚ Ðº ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚Ð¸. ÐšÐ¾Ð¼Ð±Ð¸Ð½Ð°Ñ†Ð¸Ñ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… Ð²Ð¸Ð´Ð¾Ð² Ð¾Ñ‚Ð´ÐµÐ»ÐºÐ¸ Ð¼Ð¾Ð¶ÐµÑ‚ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÐµÐ½Ð½Ð¾ ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ Ñ†ÐµÐ½Ñƒ.
5.  Ð Ð°Ð·Ð¼ÐµÑ€Ñ‹ Ð¸ ÑÐ»Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ ÐºÐ¾Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸: Ð‘Ð¾Ð»ÑŒÑˆÐ¸Ðµ Ñ€Ð°Ð·Ð¼ÐµÑ€Ñ‹ Ñ‚Ñ€ÐµÐ±ÑƒÑŽÑ‚ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð°. Ð¡Ð»Ð¾Ð¶Ð½Ñ‹Ðµ ÐºÐ¾Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸ Ð´Ð¾Ñ€Ð¾Ð¶Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ñ….
6.  Ð¤ÑƒÑ€Ð½Ð¸Ñ‚ÑƒÑ€Ð°: Ð›ÑŽÐ²ÐµÑ€ÑÑ‹, Ð¼Ð°Ð³Ð½Ð¸Ñ‚Ñ‹, Ð»ÐµÐ½Ñ‚Ñ‹ Ð´Ð»Ñ Ð·Ð°Ð²ÑÐ·Ñ‹Ð²Ð°Ð½Ð¸Ñ Ð¸ Ñ‚.Ð¿. Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑŽÑ‚ Ðº ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚Ð¸.
7.  Ð•ÑÐ»Ð¸ Ñ‚Ð¾Ñ‡Ð½Ð¾Ð³Ð¾ Ð°Ð½Ð°Ð»Ð¾Ð³Ð° Ð² Ð±Ð°Ð·Ðµ Ð½ÐµÑ‚: ÐŸÐ¾ÑÑ‚Ð°Ñ€Ð°Ð¹ÑÑ Ð¸Ð½Ñ‚ÐµÑ€Ð¿Ð¾Ð»Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ/ÑÐºÑÑ‚Ñ€Ð°Ð¿Ð¾Ð»Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð½Ð°Ð¸Ð±Ð¾Ð»ÐµÐµ Ð±Ð»Ð¸Ð·ÐºÐ¸Ñ… Ð¿Ð¾ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ð¼ Ð·Ð°ÐºÐ°Ð·Ð¾Ð², Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ ÑÑ‚Ð¸ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°.
8.  **Ð¢Ð¾Ñ‡Ð½Ð¾ÑÑ‚ÑŒ Ð¸ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½:** ÐŸÑ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼Ð°Ñ Ñ‚Ð¾Ð±Ð¾Ð¹ Ñ‚Ð¾Ñ‡ÐµÑ‡Ð½Ð°Ñ Ð¾Ñ†ÐµÐ½ÐºÐ° Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ñ‚Ð²Ð¾ÐµÐ¹ Ð½Ð°Ð¸Ð»ÑƒÑ‡ÑˆÐµÐ¹ Ð¾Ñ†ÐµÐ½ÐºÐ¾Ð¹ *ÑÑ€ÐµÐ´Ð½ÐµÐ¹* Ñ†ÐµÐ½Ñ‹. ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ÑƒÐ²Ð¸Ð´Ð¸Ñ‚ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½ Â±15% Ð¾Ñ‚ ÑÑ‚Ð¾Ð¹ Ð¾Ñ†ÐµÐ½ÐºÐ¸. Ð¡Ñ‚Ð°Ñ€Ð°Ð¹ÑÑ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ñ‚Ð²Ð¾Ñ ÑÑ€ÐµÐ´Ð½ÑÑ Ð¾Ñ†ÐµÐ½ÐºÐ° Ð±Ñ‹Ð»Ð° Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾ Ð±Ð»Ð¸Ð·ÐºÐ° Ðº Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ñ€Ñ‹Ð½Ð¾Ñ‡Ð½Ð¾Ð¹ Ñ†ÐµÐ½Ðµ Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ñ‹Ñ… Ð·Ð°ÐºÐ°Ð·Ð¾Ð² Ð² ÐšÐ¸Ñ‚Ð°Ðµ.
9.  Ð•ÑÐ»Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÐ¾Ð²ÑÐµÐ¼ Ð¼Ð°Ð»Ð¾ Ð´Ð»Ñ ÑƒÐ²ÐµÑ€ÐµÐ½Ð½Ð¾Ð¹ Ð¾Ñ†ÐµÐ½ÐºÐ¸, Ð¸Ð»Ð¸ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¾Ñ‡ÐµÐ½ÑŒ Ð½ÐµÐ¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ðµ, ÑƒÐºÐ°Ð¶Ð¸ ÑÑ‚Ð¾, Ð½Ð¾ Ð²ÑÐµ Ñ€Ð°Ð²Ð½Ð¾ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶Ð¸ Ð½Ð°Ð¸Ð±Ð¾Ð»ÐµÐµ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ.

**Ð¦ÐµÐ½Ð¾Ð²Ñ‹Ðµ Ð¾Ñ€Ð¸ÐµÐ½Ñ‚Ð¸Ñ€Ñ‹ Ð´Ð»Ñ ÐŸÐÐšÐ•Ð¢ÐžÐ’ (Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ñ‹ Ð½Ð° Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð°Ñ…):**

10. **Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ðµ Ð¿Ð°ÐºÐµÑ‚Ñ‹ Ð¸Ð· Ð¼ÐµÐ»Ð¾Ð²Ð°Ð½Ð½Ð¾Ð¹ Ð±ÑƒÐ¼Ð°Ð³Ð¸ (200-250 Ð³/Ð¼Â²):**
    *   ÐœÐ°Ð»Ñ‹Ðµ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð¨Ñ…Ð’Ñ…Ð“ Ð¾ÐºÐ¾Ð»Ð¾ 115x175x50 Ð¼Ð¼), Ð¿Ð¾Ð»Ð½Ð¾Ñ†Ð²ÐµÑ‚, Ð»Ð°Ð¼Ð¸Ð½Ð°Ñ†Ð¸Ñ: 1000 ÑˆÑ‚. ~2.9-3.2 Â¥/ÑˆÑ‚; 500 ÑˆÑ‚. ~3.9-4.3 Â¥/ÑˆÑ‚.
    *   Ð¡Ñ€ÐµÐ´Ð½Ð¸Ðµ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 200x230x100 Ð¼Ð¼), Ð¿Ð¾Ð»Ð½Ð¾Ñ†Ð²ÐµÑ‚, Ð»Ð°Ð¼Ð¸Ð½Ð°Ñ†Ð¸Ñ: 1000 ÑˆÑ‚. ~3.3-3.8 Â¥/ÑˆÑ‚; 500 ÑˆÑ‚. ~4.6-5.0 Â¥/ÑˆÑ‚.
    *   ÐšÑ€ÑƒÐ¿Ð½Ñ‹Ðµ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 250x350x100 Ð¼Ð¼), Ð¿Ð¾Ð»Ð½Ð¾Ñ†Ð²ÐµÑ‚, Ð»Ð°Ð¼Ð¸Ð½Ð°Ñ†Ð¸Ñ: 1000 ÑˆÑ‚. ~4.0-4.5 Â¥/ÑˆÑ‚; 500 ÑˆÑ‚. ~5.2-5.8 Â¥/ÑˆÑ‚.
    *   ÐžÑ‡ÐµÐ½ÑŒ ÐºÑ€ÑƒÐ¿Ð½Ñ‹Ðµ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 250x300x170 Ð¼Ð¼): 1000 ÑˆÑ‚. ~4.3-4.8 Â¥/ÑˆÑ‚; 500 ÑˆÑ‚. ~5.6-6.2 Â¥/ÑˆÑ‚.

11. **ÐšÑ€Ð°Ñ„Ñ‚-Ð¿Ð°ÐºÐµÑ‚Ñ‹ (120-180 Ð³/Ð¼Â²):**
    *   ÐŸÑ€Ð¾ÑÑ‚Ð°Ñ Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ (1-2 Ñ†Ð²ÐµÑ‚Ð°), Ð±ÐµÐ· ÑÐ»Ð¾Ð¶Ð½Ð¾Ð¹ Ð¾Ñ‚Ð´ÐµÐ»ÐºÐ¸, Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾ Ð½Ð° 25-40% Ð´ÐµÑˆÐµÐ²Ð»Ðµ Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ñ‹Ñ… Ð¼ÐµÐ»Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ….
    *   ÐŸÑ€Ð¸Ð¼ÐµÑ€: 360x300x120 Ð¼Ð¼, 140 Ð³/Ð¼Â², Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ 1+0, Ñ‚Ð¸Ñ€Ð°Ð¶ 3000 ÑˆÑ‚. ~1.4-1.8 Â¥/ÑˆÑ‚.
    *   ÐŸÑ€Ð¸Ð¼ÐµÑ€: 400x250x130 Ð¼Ð¼, 180 Ð³/Ð¼Â², Ð¾Ð±Ñ‹Ñ‡Ð½Ð°Ñ Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ, Ñ‚Ð¸Ñ€Ð°Ð¶ 1000 ÑˆÑ‚. ~2.8-3.2 Â¥/ÑˆÑ‚; 500 ÑˆÑ‚. ~4.6-5.0 Â¥/ÑˆÑ‚.

12. **ÐŸÐ°ÐºÐµÑ‚Ñ‹ Ð¸Ð· ÑÐ¿ÐµÑ†Ð¸Ð°Ð»ÑŒÐ½Ð¾Ð¹/Ð´Ð¸Ð·Ð°Ð¹Ð½ÐµÑ€ÑÐºÐ¾Ð¹ Ð±ÑƒÐ¼Ð°Ð³Ð¸ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð¿Ð»Ð¾Ñ‚Ð½Ñ‹Ðµ 270Ð³+):**
    *   ÐœÐ¾Ð³ÑƒÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð½Ð° 30-70% Ð´Ð¾Ñ€Ð¾Ð¶Ðµ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ñ… Ð¼ÐµÐ»Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ…, Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾ Ñ Ñ‚Ð¸ÑÐ½ÐµÐ½Ð¸ÐµÐ¼.
    *   ÐŸÑ€Ð¸Ð¼ÐµÑ€: ÑÐ¿ÐµÑ†Ð±ÑƒÐ¼Ð°Ð³Ð° 270Ð³, Ñ‚Ð¸ÑÐ½ÐµÐ½Ð¸Ðµ, 280x220x100Ð¼Ð¼, 1000 ÑˆÑ‚. ~7.8-8.5 Â¥/ÑˆÑ‚; 500 ÑˆÑ‚. ~8.8-9.5 Â¥/ÑˆÑ‚.
    *   ÐŸÑ€Ð¸Ð¼ÐµÑ€: Ð±ÐµÐ»Ñ‹Ð¹ Ð¿Ð°ÐºÐµÑ‚, Ñ‚Ð¸ÑÐ½ÐµÐ½Ð¸Ðµ Ñ„Ð¾Ð»ÑŒÐ³Ð¾Ð¹, Ñ…Ð»Ð¾Ð¿ÐºÐ¾Ð²Ð°Ñ Ñ€ÑƒÑ‡ÐºÐ°, 200Ñ…300Ñ…40Ð¼Ð¼(?? Ð½Ðµ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð¿Ð¾Ñ€Ñ†Ð¸Ð¸), 500 ÑˆÑ‚. ~8.0-9.0 Â¥/ÑˆÑ‚.

13. **Ð’Ð»Ð¸ÑÐ½Ð¸Ðµ Ð¾Ñ‚Ð´ÐµÐ»ÐºÐ¸ Ð½Ð° Ð¿Ð°ÐºÐµÑ‚Ñ‹:**
    *   Ð¢Ð¸ÑÐ½ÐµÐ½Ð¸Ðµ (Ð·Ð¾Ð»Ð¾Ñ‚Ð¾/ÑÐµÑ€ÐµÐ±Ñ€Ð¾/Ñ„Ð¾Ð»ÑŒÐ³Ð°): +0.6 Ð´Ð¾ +1.8 Â¥/ÑˆÑ‚. Ð² Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ‚ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° Ñ‚Ð¸ÑÐ½ÐµÐ½Ð¸Ñ Ð¸ Ñ‚Ð¸Ñ€Ð°Ð¶Ð°.
    *   Ð›ÑŽÐ²ÐµÑ€ÑÑ‹: +0.3 Ð´Ð¾ +0.6 Â¥/ÑˆÑ‚.
    *   Ð“Ð¾Ñ€ÑÑ‡ÐµÐµ Ñ‚Ð¸ÑÐ½ÐµÐ½Ð¸Ðµ Ð·Ð¾Ð»Ð¾Ñ‚Ð¾Ð¼ Ð´Ð»Ñ Ð»Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿Ð°: +0.8 Ð´Ð¾ +1.5 Â¥/ÑˆÑ‚.

14. **Ð ÑƒÑ‡ÐºÐ¸ Ð´Ð»Ñ Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²:**
    *   Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ðµ Ð²ÐµÑ€ÐµÐ²Ð¾Ñ‡Ð½Ñ‹Ðµ/Ð±ÑƒÐ¼Ð°Ð¶Ð½Ñ‹Ðµ Ñ‡Ð°ÑÑ‚Ð¾ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ñ‹.
    *   Ð›ÐµÐ½Ñ‚Ð¾Ñ‡Ð½Ñ‹Ðµ (Ð°Ñ‚Ð»Ð°Ñ, Ñ€ÐµÐ¿Ñ, Ñ…Ð»Ð¾Ð¿Ð¾Ðº), Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾ Ð²ÐºÐ»ÐµÐµÐ½Ð½Ñ‹Ðµ Ð¸Ð»Ð¸ Ð½Ð° Ð»ÑŽÐ²ÐµÑ€ÑÐ°Ñ…: +0.4 Ð´Ð¾ +1.0 Â¥/ÑˆÑ‚.
    *   Ð’Ñ‹Ñ€ÑƒÐ±Ð½Ð°Ñ Ñ€ÑƒÑ‡ÐºÐ°: Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾ Ð½Ðµ ÑÐ¸Ð»ÑŒÐ½Ð¾ Ð¼ÐµÐ½ÑÐµÑ‚ Ñ†ÐµÐ½Ñƒ Ð¿Ð¾ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸ÑŽ ÑÐ¾ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð¹ Ð²ÐµÑ€ÐµÐ²Ð¾Ñ‡Ð½Ð¾Ð¹, ÐµÑÐ»Ð¸ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð» Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚.

**Ð¦ÐµÐ½Ð¾Ð²Ñ‹Ðµ Ð¾Ñ€Ð¸ÐµÐ½Ñ‚Ð¸Ñ€Ñ‹ Ð´Ð»Ñ ÐšÐžÐ ÐžÐ‘ÐžÐš (Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ñ‹ Ð½Ð° Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð°Ñ…):**

15. **ÐšÐ¾Ñ€Ð¾Ð± "ÑÐ°Ð¼Ð¾Ð»ÐµÑ‚" Ð¸Ð· Ð³Ð¾Ñ„Ñ€Ð¾ÐºÐ°Ñ€Ñ‚Ð¾Ð½Ð° (ÐºÐ°ÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð¸Ð»Ð¸ Ñ Ð¿Ñ€ÑÐ¼Ð¾Ð¹ Ð¿ÐµÑ‡Ð°Ñ‚ÑŒÑŽ):**
    *   ÐœÐ°Ð»Ñ‹Ð¹ (Ð¨Ñ…Ð”Ñ…Ð’ ~140x180x80 Ð¼Ð¼), Ð¿Ñ€Ð¾ÑÑ‚Ð°Ñ Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ, Ñ‚Ð¸Ñ€Ð°Ð¶ 1000 ÑˆÑ‚. - Ñ†ÐµÐ½Ð° Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð² Ñ€Ð°Ð¹Ð¾Ð½Ðµ 4-7 Â¥/ÑˆÑ‚, Ð´Ð»Ñ 500 ÑˆÑ‚ - 5-9 Â¥/ÑˆÑ‚.
    *   Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ (400Ñ…300Ñ…100 Ð¼Ð¼), ÐºÐ°ÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹, ÑÐ»Ð¾Ð¶Ð½Ð°Ñ Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ/Ð¿Ð°Ð½Ñ‚Ð¾Ð½, Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ Ñ‚Ð¸ÑÐ½ÐµÐ½Ð¸Ðµ, 500 ÑˆÑ‚. ~18-25 Â¥/ÑˆÑ‚. (Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ Ñ‚Ð¸ÑÐ½ÐµÐ½Ð¸Ñ).
    *   ÐšÑ€ÑƒÐ¿Ð½Ñ‹Ð¹ (600Ñ…500Ñ…170 Ð¼Ð¼), ÐºÐ°ÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹, Ð³Ð»ÑÐ½Ñ†ÐµÐ²Ñ‹Ð¹, ÑÐ»Ð¾Ð¶Ð½Ð°Ñ Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ (ÑÐµÑ€ÐµÐ±Ñ€Ð¾), 1000 ÑˆÑ‚. ~30-38 Â¥/ÑˆÑ‚; 500 ÑˆÑ‚. ~45-55 Â¥/ÑˆÑ‚.
    *   ÐŸÑ€Ð¸Ð¼ÐµÑ€: ÐšÐ¾Ñ€Ð¾Ð± ÑÐ°Ð¼Ð¾Ð»ÐµÑ‚, Ð»Ð¾Ð³Ð¾ ÑÐ¸Ð½Ð¸Ð¹, ÑÐ½Ð°Ñ€ÑƒÐ¶Ð¸ ÑÐµÑ€ÐµÐ±Ñ€Ð¾, Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÑÐ¸Ð½Ð¸Ð¹, 320Ñ…320Ñ…120Ð¼Ð¼, 500 ÑˆÑ‚ ~19-23 Â¥/ÑˆÑ‚.

16. **ÐšÐ¾Ñ€Ð¾Ð± Ð¸Ð· Ð¼Ð¸ÐºÑ€Ð¾Ð³Ð¾Ñ„Ñ€Ð¾ÐºÐ°Ñ€Ñ‚Ð¾Ð½Ð°, Ð¾Ð±ÐºÐ»ÐµÐµÐ½Ð½Ñ‹Ð¹ Ð¼ÐµÐ»Ð¾Ð²ÐºÐ¾Ð¹, Ð¿Ð¾Ð»Ð½Ð¾Ñ†Ð²ÐµÑ‚:**
    *   ÐŸÑ€Ð¸Ð¼ÐµÑ€: ~500Ñ…200Ñ…150 Ð¼Ð¼ (ÑƒÑÑ€ÐµÐ´Ð½ÐµÐ½Ð½Ñ‹Ð¹ Ð¾Ñ‚ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… Ñ€Ð°Ð·Ð¼ÐµÑ€Ð¾Ð²), Ñ‚Ð¸Ñ€Ð°Ð¶ 5000 ÑˆÑ‚. ~5.0-7.0 Â¥/ÑˆÑ‚. Ð·Ð° ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð¸Ð· Ñ€Ð°Ð·Ð¼ÐµÑ€Ð¾Ð².

**Ð¦ÐµÐ½Ð¾Ð²Ñ‹Ðµ Ð¾Ñ€Ð¸ÐµÐ½Ñ‚Ð¸Ñ€Ñ‹ Ð´Ð»Ñ Ð‘Ð˜Ð ÐžÐš:**

17. **Ð‘Ð¸Ñ€ÐºÐ¸ ÐºÐ°Ñ€Ñ‚Ð¾Ð½Ð½Ñ‹Ðµ (Ð¿Ð»Ð¾Ñ‚Ð½Ð¾ÑÑ‚ÑŒ 0.6-0.8Ð¼Ð¼ / ~300-400Ð³/Ð¼2):**
    *   Ð Ð°Ð·Ð¼ÐµÑ€ ~60x100 Ð¼Ð¼, Ñ‚Ð¸ÑÐ½ÐµÐ½Ð¸Ðµ, Ð¾Ñ‚Ð²ÐµÑ€ÑÑ‚Ð¸Ðµ, Ñ‚Ð¸Ñ€Ð°Ð¶ 6000 ÑˆÑ‚. ~0.4-0.8 Â¥/ÑˆÑ‚. (Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ ÑÐ»Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ Ñ‚Ð¸ÑÐ½ÐµÐ½Ð¸Ñ Ð¸ Ñ‚ÐµÐºÑÑ‚ÑƒÑ€Ñ‹).

ÐŸÐ¾Ð¼Ð½Ð¸, Ñ‡Ñ‚Ð¾ ÑÑ‚Ð¸ Ñ†ÐµÐ½Ñ‹ - ÐžÐ Ð˜Ð•ÐÐ¢Ð˜Ð Ð«. ÐšÐ¾Ð½ÐµÑ‡Ð½Ð°Ñ Ñ†ÐµÐ½Ð° ÑÐ¸Ð»ÑŒÐ½Ð¾ Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ ÐšÐžÐÐšÐ Ð•Ð¢ÐÐžÐ“Ðž ÐŸÐžÐ¡Ð¢ÐÐ’Ð©Ð˜ÐšÐ, Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð°, ÑÐ»Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ Ð´Ð¸Ð·Ð°Ð¹Ð½Ð° Ð¸ Ð´Ñ€ÑƒÐ³Ð¸Ñ… Ñ„Ð°ÐºÑ‚Ð¾Ñ€Ð¾Ð². Ð¢Ð²Ð¾Ñ Ð·Ð°Ð´Ð°Ñ‡Ð° - Ð´Ð°Ñ‚ÑŒ Ð½Ð°Ð¸Ð±Ð¾Ð»ÐµÐµ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½ÑƒÑŽ Ð¾Ñ†ÐµÐ½ÐºÑƒ, Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ð½ÑƒÑŽ Ð½Ð° ÑÑ‚Ð¸Ñ… Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°Ñ… Ð¸ Ñ‚Ð²Ð¾ÐµÐ¼ Ð¾Ð±Ñ‰ÐµÐ¼ Ð¿Ð¾Ð½Ð¸Ð¼Ð°Ð½Ð¸Ð¸ Ñ€Ñ‹Ð½ÐºÐ°.
`;

// Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Gemini API - Ð¿ÐµÑ€ÐµÐ¼ÐµÑ‰ÐµÐ½Ð¾ Ð²Ð½ÑƒÑ‚Ñ€ÑŒ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð°
// const genAI = new GoogleGenerativeAI(c.env.GOOGLE_API_KEY);

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ðº Gemini
app.post('/api/ask', async (c) => {
  try {
    console.log("Received /api/ask request");
    const { query } = await c.req.json();
    console.log("Query received: ", query);
    const genAI = new GoogleGenerativeAI(c.env.GOOGLE_API_KEY, { api_endpoint: 'generativelanguage.googleapis.com' }); // Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð·Ð´ÐµÑÑŒ Ñ ÑÐ²Ð½Ñ‹Ð¼ ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚Ð¾Ð¼
    console.log("GoogleGenerativeAI initialized.");
    const model = genAI.getGenerativeModel({ model: 'gemini-2.0-flash-001' });
    console.log("Gemini model obtained.");
    
    // ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¸ Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³ Ð±Ð°Ð·Ñ‹ Ð·Ð½Ð°Ð½Ð¸Ð¹ Ð¸Ð· KV
    const ordersCsv = await c.env.ORDERS_KB.get('orders_data');
    let historicalOrdersPrompt = '';
    if (ordersCsv) {
      const ordersData = parseCSV(ordersCsv);
      historicalOrdersPrompt = `\nÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ñ… Ð·Ð°ÐºÐ°Ð·Ð¾Ð² (Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ CSV, Ð´Ð»Ñ ÑÐ¿Ñ€Ð°Ð²ÐºÐ¸):
${ordersCsv}

`; // Ð’ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ Ð²ÐµÑÑŒ CSV ÐºÐ°Ðº ÐµÑÑ‚ÑŒ, Gemini Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑƒÐ¼Ð½Ð°, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾Ð½ÑÑ‚ÑŒ ÐµÐ³Ð¾.
    }

    const combinedPrompt = `
${KNOWLEDGE_BASE_STRUCTURE_PROMPT}

${PRICING_RULES_PROMPT}

${historicalOrdersPrompt}
Ð’Ñ‹ ÑÐ²Ð»ÑÐµÑ‚ÐµÑÑŒ ÑÐºÑÐ¿ÐµÑ€Ñ‚Ð¾Ð¼ Ð¿Ð¾ Ñ€Ð°ÑÑ‡ÐµÑ‚Ñƒ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚Ð¸ ÑƒÐ¿Ð°ÐºÐ¾Ð²ÐºÐ¸. Ð’Ð°ÑˆÐ° Ð·Ð°Ð´Ð°Ñ‡Ð° - Ð°Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð² Ð¸ Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÑ‚ÑŒ Ð¿Ñ€ÐµÐ´Ð²Ð°Ñ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ñ€Ð°ÑÑ‡ÐµÑ‚ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¸ Ð´ÐµÑ‚Ð°Ð»Ð¸ Ð·Ð°ÐºÐ°Ð·Ð° Ð½Ð° ÑƒÐ¿Ð°ÐºÐ¾Ð²ÐºÑƒ. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¸Ð· Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ð´Ð»Ñ Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¾Ñ‚Ð²ÐµÑ‚Ð°.

Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð° Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¼:

# ðŸ“¦ Ð Ð°ÑÑ‡ÐµÑ‚ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚Ð¸ ÑƒÐ¿Ð°ÐºÐ¾Ð²ÐºÐ¸

## ðŸ“‹ Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð·Ð°ÐºÐ°Ð·Ð°:
* **Ð¢Ð¸Ð¿ ÑƒÐ¿Ð°ÐºÐ¾Ð²ÐºÐ¸:** [ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, ÐŸÐ°ÐºÐµÑ‚ Ð¸Ð· Ð¼ÐµÐ´Ð½Ð¾Ð¹ Ð±ÑƒÐ¼Ð°Ð³Ð¸]
* **ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð»:** [ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, ÐœÐµÐ´Ð½Ð°Ñ Ð±ÑƒÐ¼Ð°Ð³Ð°, 280 Ð³/Ð¼Â²]
* **Ð’Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑÑ Ñ‡Ð°ÑÑ‚ÑŒ:** [ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð‘ÐµÐ»Ð°Ñ]
* **ÐŸÐµÑ‡Ð°Ñ‚ÑŒ:** [ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, ÐžÐ±Ñ‹Ñ‡Ð½Ð°Ñ Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ Ð»Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿Ð° (Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð¼Ð°ÐºÐµÑ‚ Ð´Ð»Ñ Ñ‚Ð¾Ñ‡Ð½Ð¾Ð¹ Ð¾Ñ†ÐµÐ½ÐºÐ¸)]
* **Ð›Ð°Ð¼Ð¸Ð½Ð°Ñ†Ð¸Ñ:** [ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð¡ÐµÐ½ÑÐ¾Ñ€Ð½Ð°Ñ (soft-touch) Ð¿Ð»ÐµÐ½ÐºÐ°]
* **ÐžÑ‚Ð²ÐµÑ€ÑÑ‚Ð¸Ñ Ð¿Ð¾Ð´ Ñ€ÑƒÑ‡ÐºÐ¸:** [ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð”Ð¸Ð°Ð¼ÐµÑ‚Ñ€ 6 Ð¼Ð¼]
* **Ð ÑƒÑ‡ÐºÐ¸:** [ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, ÐÐµ Ð½ÑƒÐ¶Ð½Ñ‹]
* **Ð¦Ð²ÐµÑ‚:** [ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð¢ÐµÐ¼Ð½Ð¾-ÑÐµÑ€Ñ‹Ð¹]
* **Ð Ð°Ð·Ð¼ÐµÑ€:** [ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 36 ÑÐ¼ (ÑˆÐ¸Ñ€Ð¸Ð½Ð°) Ã— 27 ÑÐ¼ (Ð²Ñ‹ÑÐ¾Ñ‚Ð°) Ã— 18 ÑÐ¼ (Ð³Ð»ÑƒÐ±Ð¸Ð½Ð°)]
* **ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾:** [ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 1000 ÑˆÑ‚ÑƒÐº]

## ðŸ’° Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ:
**Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð·Ð°ÐºÐ°Ð·Ð°: [ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 12 345.67 Â¥]**

*ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ: Ð­Ñ‚Ð¾ Ð¿Ñ€ÐµÐ´Ð²Ð°Ñ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð¾Ñ†ÐµÐ½ÐºÐ°. Ð¢Ð¾Ñ‡Ð½Ð°Ñ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ ÑÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð° Ð¿Ð¾ÑÐ»Ðµ Ð¾Ñ†ÐµÐ½ÐºÐ¸ Ð¼Ð°ÐºÐµÑ‚Ð° Ð¸ ÑƒÑ‚Ð¾Ñ‡Ð½ÐµÐ½Ð¸Ñ Ð²ÑÐµÑ… Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹ Ð·Ð°ÐºÐ°Ð·Ð°.*

Ð•ÑÐ»Ð¸ ÐºÐ°ÐºÐ¾Ð¹-Ñ‚Ð¾ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ Ð½ÐµÑ‚ Ð² Ð·Ð°Ð¿Ñ€Ð¾ÑÐµ, ÑƒÐºÐ°Ð¶Ð¸Ñ‚Ðµ "ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ð¾" Ð¸Ð»Ð¸ "ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ" Ñ‚Ð°Ð¼, Ð³Ð´Ðµ ÑÑ‚Ð¾ Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ð¸Ð¼Ð¾.

ÐšÐ»Ð¸ÐµÐ½Ñ‚ÑÐºÐ¸Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ: ${query}

ÐžÑ‚Ð²ÐµÑ‡Ð°Ð¹Ñ‚Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ð¾Ð¼ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ, Ð½Ðµ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐ¹Ñ‚Ðµ Ð»Ð¸ÑˆÐ½Ð¸Ð¹ Ñ‚ÐµÐºÑÑ‚ Ð´Ð¾ Ð¸Ð»Ð¸ Ð¿Ð¾ÑÐ»Ðµ Ð½ÐµÐ³Ð¾. Ð•ÑÐ»Ð¸ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð½Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÑÑ Ðº Ñ€Ð°ÑÑ‡ÐµÑ‚Ñƒ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚Ð¸ ÑƒÐ¿Ð°ÐºÐ¾Ð²ÐºÐ¸, Ð¸Ð·Ð²Ð¸Ð½Ð¸Ñ‚ÐµÑÑŒ Ð¸ ÑÐºÐ°Ð¶Ð¸Ñ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð²Ñ‹ Ð¿Ñ€ÐµÐ´Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ñ‹ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ñ€Ð°ÑÑ‡ÐµÑ‚Ð¾Ð² ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚Ð¸ ÑƒÐ¿Ð°ÐºÐ¾Ð²ÐºÐ¸.`;

    const result = await model.generateContent(combinedPrompt);
    console.log("Content generation result received.");
    const response = await result.response;
    const text = response.text();
    console.log("Response text: ", text);
    
    // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð»Ð¾Ð³ Ð² KV
    const requestId = crypto.randomUUID();
    await c.env.LOGS.put(requestId, JSON.stringify({
      requestId,
      timestamp: new Date().toISOString(),
      query,
      response: text,
      price: 0.00025 // ÐŸÑ€Ð¸Ð¼ÐµÑ€Ð½Ð°Ñ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°
    }));
    
    return c.json({ response: text, requestId });
  } catch (error) {
    console.error('Error:', error);
    return c.json({ error: error.message }, 500);
  }
});

// ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð»Ð¾Ð³Ð¾Ð²
app.get('/api/logs', async (c) => {
  try {
    const logs = [];
    const list = await c.env.LOGS.list();
    
    for (const key of list.keys) {
      const value = await c.env.LOGS.get(key.name);
      if (value) {
        logs.push(JSON.parse(value));
      }
    }
    
    return c.json({ logs });
  } catch (error) {
    console.error('Error:', error);
    return c.json({ error: error.message }, 500);
  }
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾Ð¹ ÑÐ²ÑÐ·Ð¸
app.post('/api/feedback', async (c) => {
  try {
    const { requestId, actualPrice } = await c.req.json();
    const log = await c.env.LOGS.get(requestId);
    
    if (log) {
      const logData = JSON.parse(log);
      logData.feedback = actualPrice;
      await c.env.LOGS.put(requestId, JSON.stringify(logData));
      return c.json({ success: true });
    }
    
    return c.json({ error: 'Log not found' }, 404);
  } catch (error) {
    console.error('Error:', error);
    return c.json({ error: error.message }, 500);
  }
});

export default {
  fetch: app.fetch,
}; 